<!DOCTYPE html>
<html lang="en-us">
<head>
<meta charset="utf-8">
<meta name="description" content="">
<meta name="generator" content="Hugo 0.95.0" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700" type="text/css">
<link rel="alternate" href="/index.xml" type="application/rss+xml" title="kliiu">
<title>SQL必知必会 - kliiu</title>
</head>
<body>

<header>
  <div class="container clearfix">
    <a  class="path" href="http://kliiu.github.io/">[kliiu]</a>
    <span class="caret"></span>
    <div class="right">
      
    </div>
  </div>
</header>

<div class="container">


<main role="main" class="article">
  
<article class="single" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="meta">

    <span class="key">published on</span>
    <span class="val"><time itemprop="datePublished" datetime="2022-03-25">March 25, 2022</time></span>


    <span class="key">in</span>
    <span class="val">

        <a href="/categories/coding">Coding</a>

    </span>


    <br>
    <span class="key">tags:</span>
    <span class="val">

        <a href="/tags/code">code</a>

        <a href="/tags/stl">STL</a>

    </span>

  </div>
  <h1 class="headline" itemprop="headline">SQL必知必会</h1>
  <section class="body" itemprop="articleBody">
    <h2 id="lesson-5-高级数据过滤">Lesson 5 高级数据过滤</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--operator AND IN OR
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> prod_id,prod_price,prod_name
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Products
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> vend_id <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;DLL01&#39;</span> <span style="color:#66d9ef">AND</span> prod_price <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">4</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> prod_id,prod_price,prod_name,vend_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Products
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> vend_id <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;DLL01&#39;</span> <span style="color:#66d9ef">OR</span> vend_id <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;BRS01&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">--AND 比OR优先级高 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> prod_price,prod_name
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Products
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> (vend_id <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;DLL01&#39;</span> <span style="color:#66d9ef">OR</span> vend_id <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;BRS01&#39;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">AND</span> prod_price <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">10</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--IN 与or功能相同
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--比OR快
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> prod_id,prod_price,prod_name,vend_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Products
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> vend_id <span style="color:#66d9ef">IN</span> (<span style="color:#e6db74">&#39;DLL01&#39;</span>,<span style="color:#e6db74">&#39;BRS01&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--NOT 否定条件,与其他条件一起使用
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> prod_name,vend_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Products
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">NOT</span> vend_id <span style="color:#66d9ef">IN</span> (<span style="color:#e6db74">&#39;DLL01&#39;</span>,<span style="color:#e6db74">&#39;BRS01&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--5.5.1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> vend_name,vend_state,vend_country
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Vendors
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> vend_country<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;USA&#39;</span> <span style="color:#66d9ef">AND</span> vend_state<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;CA&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--5.5.2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> order_num,prod_id,quantity
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> OrderItems
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> prod_id <span style="color:#66d9ef">IN</span> (<span style="color:#e6db74">&#39;BR01&#39;</span>,<span style="color:#e6db74">&#39;BR02&#39;</span>,<span style="color:#e6db74">&#39;BR03&#39;</span>) <span style="color:#66d9ef">AND</span> quantity<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">100</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--5.5.3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> prod_name,prod_price
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Products
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> prod_price<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">3</span> <span style="color:#66d9ef">AND</span> prod_price<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> prod_price
</span></span><span style="display:flex;"><span><span style="color:#75715e">--
</span></span></span></code></pre></div><h2 id="lesson-6-用通配符进行过滤">Lesson 6 用通配符进行过滤</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">--通配符只能用于文本字段
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> prod_id,prod_name
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Products
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> prod_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;Fish%&#39;</span>;<span style="color:#75715e">--%表示任意字符出现任意次数，Fish开头的
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> prod_id,prod_name
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Products
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> prod_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;F%y&#39;</span>;<span style="color:#75715e">-- WHERE email LIKE &#39;b%@forta.com&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> prod_id,prod_name
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Products
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> prod_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;_ inch teddy bear&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- _ 下划线只匹配单个字符
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--输出 8 inch teddy bear, 而不会返回 12 inch teddy bear
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> cust_contact
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Customers
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> cust_contact <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;[JM]%&#39;</span><span style="color:#75715e">--[]匹配方括号中任意一个字符，%匹配第一个字符后的任意数目字符。返回以J或M开头的
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> cust_contact;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> cust_contact
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Customers
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> cust_contact <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;[^JM]%&#39;</span><span style="color:#75715e">-- ^脱字号 否定
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> cust_contact;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> cust_contact
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Customers
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">NOT</span> cust_contact <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;[JM]%&#39;</span><span style="color:#75715e">-- NOT 否定
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> cust_contact;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--6.4.1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> prod_desc,prod_name
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Products
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> prod_desc <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%toy%&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--6.4.2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> prod_desc,prod_name
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Products
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">NOT</span> prod_desc <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%toy%&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--6.4.3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> prod_desc,prod_name
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Products
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> (prod_desc <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%toy%&#39;</span> )
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">AND</span> (prod_desc <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%carrots%&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--6.4.4
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> prod_desc,prod_name
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Products
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> prod_desc <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%toy%carrots%&#39;</span> ;
</span></span></code></pre></div><h2 id="lesson-7-创建计算字段">Lesson 7 创建计算字段</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--拼接 +
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> vend_name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;(&#39;</span><span style="color:#f92672">+</span> vend_country <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;)&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Vendors
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> vend_name;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--去掉值右边的全部空格 ：RTRIM()函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--去掉左边的空格LTRIM(),TRIM()去掉左右的空格
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> RTRIM(vend_name)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;(&#39;</span><span style="color:#f92672">+</span>RTRIM(vend_country)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;)&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Vendors
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> vend_name;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--别名 as
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> RTRIM(vend_name)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;(&#39;</span><span style="color:#f92672">+</span>RTRIM(vend_country)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;)&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">AS</span> vend_title
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Vendors
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> vend_name;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--执行算数计算
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> prod_id,quantity,item_price,
</span></span><span style="display:flex;"><span>quantity<span style="color:#f92672">*</span>item_price <span style="color:#66d9ef">AS</span> expand_price<span style="color:#75715e">--计算字段
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">FROM</span> OrderItems
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> order_num<span style="color:#f92672">=</span><span style="color:#ae81ff">20008</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--7.5.1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span>  vend_id,vend_name <span style="color:#66d9ef">AS</span> vname,
</span></span><span style="display:flex;"><span>vend_address <span style="color:#66d9ef">AS</span> vaddress,
</span></span><span style="display:flex;"><span>vend_city <span style="color:#66d9ef">AS</span> vcity
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Vendors
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> vend_name;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--7.5.2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> prod_id,prod_price,
</span></span><span style="display:flex;"><span>prod_price<span style="color:#f92672">*</span><span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">9</span> <span style="color:#66d9ef">AS</span> sale_price<span style="color:#75715e">--计算字段
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">FROM</span> Products;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">--8 使用函数处理数据
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--upper()upper,Upper()  转换为大写
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--LOWER()			转换为小写
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--LEFT()			返回最左边的字符
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--RIGHT()			返回最右边的字符
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--LTRIN()			去掉左边空格
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--RTRIN()			去掉左边空格
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--SUBSTR(),SUBSYRING()提取组成部分
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--SOUNDEX()   语音类似的字符串
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> vend_name,<span style="color:#66d9ef">UPPER</span>(vend_name) <span style="color:#66d9ef">AS</span> vend_name_upcase
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Vendors
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> vend_name;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--DATEPART()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--返回日期的某一部分
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Orders
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> DATEPART(yy,order_date) <span style="color:#f92672">=</span> <span style="color:#ae81ff">2020</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--DATETIME BETWEEN AND
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Orders
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> order_date <span style="color:#66d9ef">BETWEEN</span> <span style="color:#e6db74">&#39;2020-01-01&#39;</span><span style="color:#66d9ef">AND</span> <span style="color:#e6db74">&#39;2021-01-12&#39;</span> ;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--数值处理函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--ABS()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--COS()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--EXP()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--PI()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--SIN()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--SQRT()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--TAN()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--8.4.1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--SUBSTRING(str,i,len)i表示第i个字符开始（计数从1开始不是从0开始）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--len表示截取长度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> cust_id,cust_name,cust_contact,cust_city,
</span></span><span style="display:flex;"><span>(<span style="color:#66d9ef">SUBSTRING</span>(cust_contact,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>)<span style="color:#f92672">+</span><span style="color:#66d9ef">SUBSTRING</span>(cust_city,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">3</span>)) <span style="color:#66d9ef">AS</span> user_login
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Customers;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--8.4.2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--选择某个时间段的两种方法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> order_num,order_date
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Orders
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> order_date <span style="color:#66d9ef">BETWEEN</span> <span style="color:#e6db74">&#39;2020-01-01&#39;</span><span style="color:#66d9ef">AND</span> <span style="color:#e6db74">&#39;2020-01-31&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> order_num,order_date
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Orders
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> DATEPART( YY,order_date)<span style="color:#f92672">=</span><span style="color:#ae81ff">2020</span> <span style="color:#66d9ef">AND</span> DATEPART(MM,order_date)<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>;
</span></span></code></pre></div><h2 id="lesson9--汇总数据">Lesson9  汇总数据</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">--Lesson 9
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--汇总数据
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--AVG()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">AVG</span>(prod_price) <span style="color:#66d9ef">AS</span> avg_price<span style="color:#75715e">--只能用于单个列,自动忽略NULL的行
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">FROM</span> Products;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--COUNT(*)  计算表中行数，不忽略NULL
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--COUNT(column)  计算某一列中有值的行数，忽略NULL
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--MAX() 忽略NULL
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--MIN() 忽略NULL
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--SUM()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- 对以上五个函数，可以指定：
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">-- ALL(默认)对所有行计算,DISTINCT只包含不同的值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--DISTINCT 不能用于COUNT(*),且必须使用列名，不能用于计算或表达式
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">AVG</span>(<span style="color:#66d9ef">DISTINCT</span> prod_price) <span style="color:#66d9ef">AS</span> avg_price
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Products
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> vend_id <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;DLL01&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--9.5.1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">SUM</span>(quantity)<span style="color:#66d9ef">AS</span> sold_prod
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> OrderItems;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--9.5.2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">SUM</span>(quantity)<span style="color:#66d9ef">AS</span> sold_prod
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> OrderItems
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> prod_id <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;BR01&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--9.5.3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">MAX</span>(prod_price)<span style="color:#66d9ef">AS</span> max_price
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Products
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> prod_price<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">10</span>;
</span></span></code></pre></div><h2 id="lesson10-分组数据">Lesson10 分组数据</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">--Lesson10 分组数据
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--过滤分组HAVING
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--过滤行WHERE
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--the same usage 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> cust_id, <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">AS</span> orders 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Orders 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> cust_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">HAVING</span> <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--WHERE 在数据分组前进行过滤
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--HAVING 在数据分组后进行过滤
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> vend_id, <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">AS</span> num_prods
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Products
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> prod_price <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> vend_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">HAVING</span> <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">2</span><span style="color:#75715e">--（计数大于等于2的分组）具有两个以上产品的供应商
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> vend_id;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--记住语句顺序↑
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--10.7.1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> order_num,<span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">AS</span> order_lines
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> OrderItems
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> order_num
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> order_lines;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--10.7.2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">MIN</span>(prod_price) <span style="color:#66d9ef">AS</span> chengben
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Products
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> vend_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> chengben;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--10.7.3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--至少含100项的所有订单的订单号
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> order_num
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> OrderItems
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> order_num
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">HAVING</span> <span style="color:#66d9ef">SUM</span>(quantity)<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> order_num;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--10.7.4
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> order_num,<span style="color:#66d9ef">SUM</span>(item_price<span style="color:#f92672">*</span>quantity) <span style="color:#66d9ef">AS</span> total
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> OrderItems
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> order_num
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">HAVING</span> <span style="color:#66d9ef">SUM</span>(item_price<span style="color:#f92672">*</span>quantity)<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> order_num;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--10.7.5
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> order_num, <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">AS</span> items 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> OrderItems 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> order_num <span style="color:#75715e">--不能是items
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">HAVING</span> <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> items, order_num;
</span></span></code></pre></div><h2 id="lesson-11-子查询">Lesson 11 子查询</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">--Lesson11 子查询
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> cust_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Orders
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> order_num <span style="color:#66d9ef">IN</span> (<span style="color:#66d9ef">SELECT</span> order_num
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">FROM</span> OrderItems
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">WHERE</span> prod_id <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;RGAN01&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">--对每个顾客执行COUNT(*)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> cust_name, cust_state, 
</span></span><span style="display:flex;"><span>		(<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) 
</span></span><span style="display:flex;"><span>		 <span style="color:#66d9ef">FROM</span> Orders 
</span></span><span style="display:flex;"><span>		 <span style="color:#66d9ef">WHERE</span> Orders.cust_id <span style="color:#f92672">=</span> Customers.cust_id) <span style="color:#66d9ef">AS</span> orders
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Customers
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> cust_name;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--11.5.1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> cust_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Orders
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> order_num <span style="color:#66d9ef">in</span> (<span style="color:#66d9ef">SELECT</span> order_num
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">FROM</span> OrderItems
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">WHERE</span> item_price<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">10</span> );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--11.5.2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> cust_id,order_date
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Orders
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> order_num <span style="color:#66d9ef">IN</span> (<span style="color:#66d9ef">SELECT</span> order_num
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">FROM</span> OrderItems
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">WHERE</span> prod_id<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;BR01&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">--11.5.3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> cust_email
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Customers
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> cust_id <span style="color:#66d9ef">IN</span> (<span style="color:#66d9ef">SELECT</span> cust_id
</span></span><span style="display:flex;"><span>				  <span style="color:#66d9ef">FROM</span> Orders
</span></span><span style="display:flex;"><span>				  <span style="color:#66d9ef">WHERE</span> order_num <span style="color:#66d9ef">IN</span> (<span style="color:#66d9ef">SELECT</span> order_num
</span></span><span style="display:flex;"><span>									  <span style="color:#66d9ef">FROM</span> OrderItems
</span></span><span style="display:flex;"><span>									  <span style="color:#66d9ef">WHERE</span> prod_id<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;BR01&#39;</span>))
</span></span><span style="display:flex;"><span>						
</span></span><span style="display:flex;"><span><span style="color:#75715e">--11.5.4
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--我们需要一个顾客 ID列表，其中包含他们已订购的总金额。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--编写SQL 语句，返回顾客 ID（Orders 表中的 cust_id）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--并使用子查询返回 total_ordered 以便返回每个顾客的订单总数。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--将结果按金额从大到小排序。提示：你之前已经使用 SUM()计算订单总数。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> cust_id,
</span></span><span style="display:flex;"><span>			(<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">SUM</span>(item_price<span style="color:#f92672">*</span>quantity)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">FROM</span> OrderItems
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">WHERE</span> Orders.order_num<span style="color:#f92672">=</span>OrderItems.order_num)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">As</span> total_ordered
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Orders
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> total_ordered <span style="color:#66d9ef">DESC</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--11.5.5
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> prod_name,
</span></span><span style="display:flex;"><span>		(<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">SUM</span>(quantity)
</span></span><span style="display:flex;"><span>		 <span style="color:#66d9ef">FROM</span> OrderItems
</span></span><span style="display:flex;"><span>		 <span style="color:#66d9ef">WHERE</span> Products.prod_id<span style="color:#f92672">=</span>OrderItems.prod_id)
</span></span><span style="display:flex;"><span>		 <span style="color:#66d9ef">AS</span> quant_sold
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Products;
</span></span><span style="display:flex;"><span>				  
</span></span></code></pre></div><h2 id="lesson-12-联结表">Lesson 12 联结表</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-SQL" data-lang="SQL"><span style="display:flex;"><span><span style="color:#75715e">-- 联结表(join)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--12.2创建联结表
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> vend_name, prod_name, prod_price 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Vendors, Products
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> Vendors.vend_id <span style="color:#f92672">=</span> Products.vend_id;
</span></span><span style="display:flex;"><span><span style="color:#75715e">--如果没有WHERE，则第一个表中的每一行都与第二个表
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--每一行匹配（笛卡尔积）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--内联结（同样写法）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> vend_name, prod_name, prod_price 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Vendors
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> Products <span style="color:#66d9ef">ON</span> Vendors.vend_id <span style="color:#f92672">=</span> Products.vend_id;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--联结多个表
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--联结越多表性能下降越厉害
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> prod_name, vend_name, prod_price, quantity 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> OrderItems, Products, Vendors
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> Products.vend_id<span style="color:#f92672">=</span>Vendors.vend_id
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">AND</span> OrderItems.prod_id<span style="color:#f92672">=</span>Products.prod_id
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">AND</span> order_num<span style="color:#f92672">=</span><span style="color:#ae81ff">20007</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e">--12.4.1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> cust_name,order_num
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Customers,Orders
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> Customers.cust_id<span style="color:#f92672">=</span>Orders.cust_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> cust_name,order_num;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> cust_name,order_num
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Customers <span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> Orders 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ON</span> Customers.cust_id<span style="color:#f92672">=</span>Orders.cust_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> cust_name,order_num;
</span></span><span style="display:flex;"><span><span style="color:#75715e">--12.4.2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--(1)子查询实现
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> cust_name,order_num,
</span></span><span style="display:flex;"><span>				(<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">SUM</span>(item_price<span style="color:#f92672">*</span>quantity)
</span></span><span style="display:flex;"><span>				 <span style="color:#66d9ef">FROM</span> OrderItems
</span></span><span style="display:flex;"><span>				 <span style="color:#66d9ef">WHERE</span> OrderItems.order_num<span style="color:#f92672">=</span>Orders.order_num)<span style="color:#66d9ef">AS</span> OrderTotal<span style="color:#75715e">--完全限定列名
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">FROM</span> Customers
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> Orders <span style="color:#66d9ef">ON</span> Customers.cust_id<span style="color:#f92672">=</span>Orders.cust_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> cust_name,order_num;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--(2)联结？
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> cust_name,Orders.order_num,<span style="color:#66d9ef">SUM</span>(item_price<span style="color:#f92672">*</span>quantity)<span style="color:#66d9ef">AS</span> OrderTotal<span style="color:#75715e">--?
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">FROM</span> Customers,Orders,OrderItems
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> Customers.cust_id<span style="color:#f92672">=</span>Orders.cust_id
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">AND</span> Orders.order_num <span style="color:#f92672">=</span>OrderItems.order_num
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> cust_name,Orders.order_num
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> cust_name,order_num;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--12.4.3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> order_date
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Orders,OrderItems
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> OrderItems.order_num<span style="color:#f92672">=</span>Orders.order_num <span style="color:#66d9ef">AND</span> prod_id<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;BR01&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> order_date
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Orders
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> OrderItems <span style="color:#66d9ef">ON</span> OrderItems.order_num<span style="color:#f92672">=</span>Orders.order_num
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> prod_id<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;BR01&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--12.4.4
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--多个联结
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> order_date,cust_email
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Orders
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> OrderItems <span style="color:#66d9ef">ON</span> OrderItems.order_num<span style="color:#f92672">=</span>Orders.order_num 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> Customers <span style="color:#66d9ef">ON</span> Orders.cust_id<span style="color:#f92672">=</span>Customers.cust_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> prod_id<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;BR01&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--12.4.5
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">/*5. 再让事情变得更加有趣些，我们将混合使用联结、聚合函数和分组。 准备好了吗？
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">回到第 10课，当时的挑战是要求查找值等于或大于 1000 的所有订单号。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">这些结果很有用，但更有用的是订单数量至少达到 这个数的顾客名称。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">因此，编写 SQL 语句，使用联结从 Customers 表返回顾客名称（cust_name），
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">并从 OrderItems 表返回所有订单的 总价。 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">提示：要联结这些表，还需要包括 Orders 表（因为 Customers 表 与 OrderItems 表不直接相关，
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">Customers 表与 Orders 表相关，而 Orders 表与 OrderItems 表相关）。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">不要忘记 GROUP BY 和 HAVING， 并按顾客名称对结果进行排序。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">你可以使用简单的等联结或 ANSI的INNER JOIN 语法。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">或者，如果你很勇敢，请尝试使用两种方式编写。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--是的，我很勇敢！
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--（1）简单的等联结
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">SELECT cust_name,SUM(quantity*order_item*item_price) AS TotalPrice,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">				SUM(quantity*order_item) AS OrderQuan--订单数量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">FROM Customers,Orders,OrderItems
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">WHERE Customers.cust_id=Orders.cust_id 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	AND OrderItems.order_num=Orders.order_num 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">Group BY Customers.cust_name
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">HAVING SUM(quantity*order_item)&gt;1000;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--（2）等联结
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">SELECT cust_name,sum(quantity*order_item*item_price) AS TotalPrice,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">				SUM(quantity*order_item) AS OrderQuan--订单数量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">FROM Orders
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">INNER JOIN Customers ON Customers.cust_id=Orders.cust_id 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">INNER JOIN OrderItems ON OrderItems.order_num=Orders.order_num 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">Group BY Customers.cust_name
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">HAVING SUM(quantity*order_item)&gt;1000;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">--题解写的是返回订单总价&gt;=1000
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> cust_name,<span style="color:#66d9ef">SUM</span>(quantity<span style="color:#f92672">*</span>item_price) <span style="color:#66d9ef">AS</span> TotalPrice,
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">SUM</span>(quantity<span style="color:#f92672">*</span>item_price) <span style="color:#66d9ef">AS</span> OrderQuan<span style="color:#75715e">--订单数量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">FROM</span> Customers,Orders,OrderItems
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> Customers.cust_id<span style="color:#f92672">=</span>Orders.cust_id 
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">AND</span> OrderItems.order_num<span style="color:#f92672">=</span>Orders.order_num 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Group</span> <span style="color:#66d9ef">BY</span> Customers.cust_name
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">HAVING</span> <span style="color:#66d9ef">SUM</span>(quantity<span style="color:#f92672">*</span>item_price)<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">1000</span>;
</span></span></code></pre></div>
  </section>
</article>

</main>

</div>

<footer>
  <div class="container">
    <span class="copyright">&copy; 2022 kliiu - <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></span>
  </div>
</footer>

</body>
</html>

